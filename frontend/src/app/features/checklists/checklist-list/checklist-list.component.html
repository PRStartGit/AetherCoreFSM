<div class="max-w-7xl mx-auto px-4 sm:px-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 m-0">Checklists</h1>
      <p class="text-sm sm:text-base text-gray-600 mt-1">Manage site inspection checklists</p>
    </div>
    <button *ngIf="!isSiteUser()"
            (click)="openCreateDialog()"
            class="w-full sm:w-auto px-4 py-2 bg-gradient-to-r from-hygiene-600 to-cyan-600 text-white rounded-lg hover:from-hygiene-700 hover:to-cyan-700 font-medium text-sm sm:text-base">
      + New Checklist
    </button>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-xl shadow-sm p-3 sm:p-4 mb-6">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">Date</label>
        <input type="date"
               [(ngModel)]="selectedDate"
               (change)="onFilterChange()"
               class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">Site</label>
        <select [(ngModel)]="selectedSite"
                (change)="onFilterChange()"
                class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="all">All Sites</option>
          <option *ngFor="let site of sites" [value]="site.id">
            {{ site.name }}
          </option>
        </select>
      </div>

      <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">Status</label>
        <select [(ngModel)]="selectedStatus"
                (change)="onFilterChange()"
                class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="all">All Statuses</option>
          <option *ngFor="let status of statuses" [value]="status">
            {{ status.replace('_', ' ') | titlecase }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-20">
    <div class="text-gray-400">Loading checklists...</div>
  </div>

  <!-- Checklists Card -->
  <div *ngIf="!loading">
    <!-- Empty State -->
    <div *ngIf="checklists.length === 0" class="bg-white rounded-xl shadow-sm text-center py-16 px-6">
      <div class="text-6xl mb-4">ðŸ“‹</div>
      <h3 class="text-lg font-semibold text-gray-700 mt-4 mb-2">No Checklists Found</h3>
      <p class="text-gray-500 mb-6">Create your first checklist to get started</p>
      <button *ngIf="!isSiteUser()"
              (click)="openCreateDialog()"
              class="px-4 py-2 bg-gradient-to-r from-hygiene-600 to-cyan-600 text-white rounded-lg hover:from-hygiene-700 hover:to-cyan-700 font-medium">
        + Create First Checklist
      </button>
    </div>

    <!-- Mobile Card View -->
    <div *ngIf="checklists.length > 0" class="md:hidden space-y-4">
      <div *ngFor="let checklist of checklists" class="bg-white rounded-xl shadow-sm p-4 border border-gray-200">
        <!-- Card Header -->
        <div class="flex justify-between items-start mb-3">
          <div class="flex-1">
            <h3 class="font-semibold text-gray-800 text-base mb-1">{{ checklist.category?.name || '-' }}</h3>
            <p class="text-sm text-gray-600">{{ getSiteName(checklist.site_id) }}</p>
          </div>
          <span class="inline-block px-2.5 py-1 rounded-lg text-xs font-semibold ml-2"
                [ngClass]="{
                  'bg-yellow-100 text-yellow-800': checklist.status === 'pending',
                  'bg-blue-100 text-blue-800': checklist.status === 'in_progress',
                  'bg-green-100 text-green-800': checklist.status === 'completed',
                  'bg-red-100 text-red-800': checklist.status === 'overdue'
                }">
            {{ checklist.status.replace('_', ' ') | titlecase }}
          </span>
        </div>

        <!-- Due Date -->
        <div class="mb-3">
          <span class="text-sm text-gray-500">Due: </span>
          <span class="text-sm font-medium"
                [ngClass]="{'text-red-600': isOverdue(checklist), 'text-gray-800': !isOverdue(checklist)}">
            {{ checklist.checklist_date | date:'dd/MM/yyyy' }}
          </span>
        </div>

        <!-- Progress -->
        <div class="mb-4">
          <div class="flex items-center justify-between mb-1.5">
            <span class="text-sm text-gray-600">Progress</span>
            <span class="text-sm font-semibold text-gray-700">{{ getProgressPercentage(checklist) }}%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="rounded-full h-2.5"
                 [ngClass]="checklist.status === 'completed' ? 'bg-green-600' : 'bg-gradient-to-r from-hygiene-600 to-cyan-600'"
                 [style.width.%]="getProgressPercentage(checklist)"></div>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex gap-2">
          <button *ngIf="canComplete(checklist)"
                  (click)="openCompletionView(checklist)"
                  class="flex-1 px-3 py-2 text-sm text-center text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg font-medium">
            Complete
          </button>
          <button *ngIf="!canComplete(checklist)"
                  (click)="openCompletionView(checklist)"
                  class="flex-1 px-3 py-2 text-sm text-center text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium">
            View
          </button>
          <button *ngIf="!isSiteUser()"
                  (click)="deleteChecklist(checklist)"
                  class="px-3 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-lg font-medium">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Desktop Table View -->
    <div *ngIf="checklists.length > 0" class="hidden md:block bg-white rounded-xl shadow-sm overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Site</th>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Category</th>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Status</th>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Due Date</th>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Progress</th>
              <th class="text-left px-6 py-4 text-sm font-semibold text-gray-700">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let checklist of checklists" class="border-b border-gray-100 hover:bg-gray-50">
              <!-- Site -->
              <td class="px-6 py-4 text-gray-800">{{ getSiteName(checklist.site_id) }}</td>

              <!-- Category -->
              <td class="px-6 py-4 text-gray-800">{{ checklist.category?.name || '-' }}</td>

              <!-- Status -->
              <td class="px-6 py-4">
                <span class="inline-block px-3 py-1 rounded-lg text-xs font-semibold"
                      [ngClass]="{
                        'bg-yellow-100 text-yellow-800': checklist.status === 'pending',
                        'bg-blue-100 text-blue-800': checklist.status === 'in_progress',
                        'bg-green-100 text-green-800': checklist.status === 'completed',
                        'bg-red-100 text-red-800': checklist.status === 'overdue'
                      }">
                  {{ checklist.status.replace('_', ' ') | titlecase }}
                </span>
              </td>

              <!-- Due Date -->
              <td class="px-6 py-4">
                <span [ngClass]="{'text-red-600 font-semibold': isOverdue(checklist), 'text-gray-800': !isOverdue(checklist)}">
                  {{ checklist.checklist_date | date:'dd/MM/yyyy' }}
                </span>
              </td>

              <!-- Progress -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <div class="flex-1 bg-gray-200 rounded-full h-2">
                    <div class="rounded-full h-2"
                         [ngClass]="checklist.status === 'completed' ? 'bg-green-600' : 'bg-gradient-to-r from-hygiene-600 to-cyan-600'"
                         [style.width.%]="getProgressPercentage(checklist)"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700 min-w-[45px]">
                    {{ getProgressPercentage(checklist) }}%
                  </span>
                </div>
              </td>

              <!-- Actions -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <button *ngIf="canComplete(checklist)"
                          (click)="openCompletionView(checklist)"
                          class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg font-medium"
                          title="Complete Checklist">
                    Complete
                  </button>
                  <button *ngIf="!canComplete(checklist)"
                          (click)="openCompletionView(checklist)"
                          class="px-3 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded-lg font-medium"
                          title="View Details">
                    View
                  </button>
                  <button *ngIf="!isSiteUser()"
                          (click)="deleteChecklist(checklist)"
                          class="px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded-lg font-medium"
                          title="Delete">
                    Delete
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
