<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 print:relative print:bg-white">
  <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto print:max-h-none print:shadow-none">
    <!-- Modal Header -->
    <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between print:hidden">
      <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
        <i class="fa-solid fa-scale-balanced text-purple-600"></i>
        Scale Recipe
      </h2>
      <button
        (click)="closeModal()"
        class="text-gray-400 hover:text-gray-600 text-2xl"
      >
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <!-- Scale Input -->
      <div *ngIf="!scaledRecipe" class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">{{ recipe.title }}</h3>
        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-4 mb-4">
          <p class="text-blue-800 text-sm">
            <i class="fa-solid fa-info-circle mr-2"></i>
            Original recipe yields: <strong>{{ recipe.yield_quantity | number:'1.0-2' }} {{ recipe.yield_unit }}</strong>
          </p>
        </div>

        <div class="flex gap-4 items-end">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              New Yield Quantity
            </label>
            <input
              type="number"
              step="0.01"
              [(ngModel)]="newYield"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
              placeholder="Enter new yield quantity"
            />
          </div>
          <button
            (click)="scaleRecipe()"
            [disabled]="loading || !newYield"
            class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"
          >
            <i class="fa-solid" [ngClass]="loading ? 'fa-spinner fa-spin' : 'fa-calculator'"></i>
            {{ loading ? 'Calculating...' : 'Calculate' }}
          </button>
        </div>

        <div *ngIf="error" class="mt-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg p-4">
          <p class="text-red-800 text-sm">{{ error }}</p>
        </div>
      </div>

      <!-- Scaled Results -->
      <div *ngIf="scaledRecipe">
        <!-- Print Header -->
        <div class="hidden print:block mb-6">
          <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ scaledRecipe.title }}</h1>
          <p class="text-gray-600">Scaled Recipe</p>
        </div>

        <!-- Scale Info -->
        <div class="mb-6 p-4 bg-purple-50 border-l-4 border-purple-500 rounded-r-lg">
          <h4 class="font-bold text-purple-900 mb-2">Scaling Information</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div>
              <span class="text-purple-800">Original Yield:</span>
              <span class="font-semibold ml-2">{{ scaledRecipe.original_yield | number:'1.0-2' }} {{ scaledRecipe.yield_unit }}</span>
            </div>
            <div>
              <span class="text-purple-800">New Yield:</span>
              <span class="font-semibold ml-2">{{ scaledRecipe.scaled_yield | number:'1.0-2' }} {{ scaledRecipe.yield_unit }}</span>
            </div>
            <div>
              <span class="text-purple-800">Scale Factor:</span>
              <span class="font-semibold ml-2">{{ scaledRecipe.scale_factor | number:'1.2-2' }}x</span>
            </div>
          </div>
        </div>

        <!-- Allergens -->
        <div *ngIf="scaledRecipe.allergens && scaledRecipe.allergens.length > 0" class="mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg">
          <h3 class="font-bold text-yellow-900 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-triangle-exclamation"></i>
            Allergens
          </h3>
          <div class="flex flex-wrap gap-2">
            <span *ngFor="let allergen of scaledRecipe.allergens"
                  class="px-3 py-1 bg-yellow-200 text-yellow-900 rounded-full text-sm font-medium">
              {{ allergen }}
            </span>
          </div>
        </div>

        <!-- Scaled Ingredients -->
        <div class="mb-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-list text-purple-600"></i>
            Scaled Ingredients
          </h3>

          <div class="space-y-2">
            <div *ngFor="let ingredient of scaledRecipe.ingredients"
                 class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
              <i class="fa-solid fa-check-circle text-purple-600 mt-1"></i>
              <div class="flex-1">
                <span class="font-bold text-purple-600">{{ ingredient.scaled_quantity | number:'1.0-2' }}</span>
                <span class="text-gray-600 mx-1">{{ ingredient.unit }}</span>
                <span>{{ ingredient.name }}</span>
                <span class="text-sm text-gray-500 ml-2">(was {{ ingredient.original_quantity | number:'1.0-2' }})</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Instructions -->
        <div *ngIf="scaledRecipe.instructions" class="mb-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-file-lines text-purple-600"></i>
            Instructions
          </h3>
          <p class="whitespace-pre-line text-gray-700">{{ scaledRecipe.instructions }}</p>
        </div>

        <!-- Notes -->
        <div *ngIf="scaledRecipe.notes" class="mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
          <h4 class="font-bold text-blue-900 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-note-sticky"></i>
            Notes
          </h4>
          <p class="text-blue-800 whitespace-pre-line">{{ scaledRecipe.notes }}</p>
        </div>

        <!-- Actions -->
        <div class="flex gap-4 justify-end print:hidden">
          <button
            (click)="scaledRecipe = null"
            class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            <i class="fa-solid fa-arrow-left mr-2"></i>
            Back
          </button>
          <button
            (click)="printScaled()"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            <i class="fa-solid fa-print mr-2"></i>
            Print
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
