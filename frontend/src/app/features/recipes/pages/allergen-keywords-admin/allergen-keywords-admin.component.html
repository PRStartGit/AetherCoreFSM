<div class="admin-page">
  <!-- Header -->
  <div class="page-header">
    <a routerLink="/recipes" class="back-btn">
      <i class="fa-solid fa-arrow-left"></i>
    </a>
    <div>
      <h1>Allergen Keywords</h1>
      <p class="subtitle">Manage keywords for automatic allergen detection in recipes</p>
    </div>
  </div>

  <div class="content-grid">
    <!-- Left Panel: Form -->
    <div class="left-panel">
      <!-- Add/Edit Form -->
      <div class="form-card">
        <div class="card-header">
          <i class="fa-solid" [ngClass]="isEditing ? 'fa-edit' : 'fa-plus-circle'"></i>
          <h2>{{ isEditing ? 'Edit Keyword' : 'Add Keyword' }}</h2>
        </div>
        <form [formGroup]="keywordForm" (ngSubmit)="onSubmit()" class="admin-form">
          <div class="form-group">
            <label for="allergen">Allergen</label>
            <div class="input-wrapper">
              <i class="fa-solid fa-triangle-exclamation"></i>
              <select id="allergen" formControlName="allergen" class="form-select">
                <option value="" disabled>Select an allergen</option>
                <option *ngFor="let allergen of allergens" [value]="allergen">
                  {{ allergen }}
                </option>
              </select>
            </div>
            <span class="error-message" *ngIf="keywordForm.get('allergen')?.touched && keywordForm.get('allergen')?.hasError('required')">
              Allergen is required
            </span>
          </div>

          <div class="form-group">
            <label for="keyword">Keyword</label>
            <div class="input-wrapper">
              <i class="fa-solid fa-tag"></i>
              <input type="text" id="keyword" formControlName="keyword" placeholder="e.g., milk, cream, butter" class="form-input">
            </div>
            <span class="hint">Enter ingredient keyword (lowercase)</span>
            <span class="error-message" *ngIf="keywordForm.get('keyword')?.touched && keywordForm.get('keyword')?.hasError('required')">
              Keyword is required
            </span>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="keywordForm.invalid">
              <i class="fa-solid" [ngClass]="isEditing ? 'fa-save' : 'fa-plus'"></i>
              {{ isEditing ? 'Update' : 'Add Keyword' }}
            </button>
            <button *ngIf="isEditing" type="button" class="btn-secondary" (click)="cancelEdit()">
              Cancel
            </button>
          </div>
        </form>
      </div>

      <!-- Info Panel -->
      <div class="info-card">
        <div class="card-header">
          <i class="fa-solid fa-info-circle text-blue-600"></i>
          <h2>About Keywords</h2>
        </div>
        <div class="info-content">
          <p>Keywords are used to automatically detect allergens in recipes based on ingredient names.</p>
          <p>When a recipe's ingredient contains a keyword, the associated allergen is automatically flagged.</p>
          <p class="example">Example: Adding "butter" as a keyword for "Milk" allergen will flag any recipe containing butter as containing milk allergen.</p>
        </div>
      </div>
    </div>

    <!-- Right Panel: Keywords List -->
    <div class="right-panel">
      <div class="table-card">
        <div class="card-header">
          <div>
            <i class="fa-solid fa-list"></i>
            <h2>Keywords by Allergen</h2>
          </div>
          <span class="count-badge">{{ keywords.length }} keywords</span>
        </div>
        <div class="keywords-container">
          <div *ngFor="let allergen of allergens" class="allergen-section">
            <div class="allergen-header" (click)="toggleAllergen(allergen)">
              <div class="allergen-title">
                <i class="fa-solid fa-chevron-right" [class.rotated]="expandedAllergens.has(allergen)"></i>
                <span>{{ allergen }}</span>
              </div>
              <span class="keyword-count">{{ getKeywordCount(allergen) }} keywords</span>
            </div>
            <div class="allergen-keywords" *ngIf="expandedAllergens.has(allergen)">
              <div *ngIf="getKeywordCount(allergen) === 0" class="empty-state">
                No keywords defined for this allergen
              </div>
              <div *ngIf="getKeywordCount(allergen) > 0" class="keywords-list">
                <div *ngFor="let kw of groupedKeywords.get(allergen)" class="keyword-chip" (click)="editKeyword(kw)">
                  <span>{{ kw.keyword }}</span>
                  <button type="button" class="delete-chip" (click)="deleteKeyword(kw); $event.stopPropagation()">
                    <i class="fa-solid fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
