<div class="p-4 md:p-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
      {{ isEditMode ? 'Edit Recipe' : 'Create New Recipe' }}
    </h1>
    <p class="text-gray-600 mt-1">{{ isEditMode ? 'Update recipe information' : 'Add a new recipe to your collection' }}</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <svg class="animate-spin h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="bg-red-50 border-l-4 border-red-500 rounded-r-lg p-4 mb-6">
    <div class="flex items-start">
      <i class="fa-solid fa-exclamation-circle text-red-600 text-xl mt-1 mr-3"></i>
      <div>
        <h3 class="font-semibold text-red-900 mb-1">Error</h3>
        <p class="text-red-800 text-sm">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Form -->
  <form *ngIf="!loading" [formGroup]="recipeForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Basic Information -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
        <i class="fa-solid fa-info-circle text-green-600 mr-2"></i>
        Basic Information
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Recipe Title <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            formControlName="title"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="Enter recipe title"
          />
          <div *ngIf="recipeForm.get('title')?.invalid && recipeForm.get('title')?.touched" class="text-red-600 text-sm mt-1">
            Recipe title is required
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <select
            formControlName="category_id"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
          >
            <option [value]="null">Select a category</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Cost Per Unit (Â£)</label>
          <input
            type="number"
            step="0.01"
            formControlName="cost_per_unit"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="0.00"
          />
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
          <textarea
            formControlName="description"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="Brief description of the recipe"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Time & Yield -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
        <i class="fa-solid fa-clock text-green-600 mr-2"></i>
        Time & Yield
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Prep Time (min)</label>
          <input
            type="number"
            formControlName="prep_time_minutes"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="0"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Cook Time (min)</label>
          <input
            type="number"
            formControlName="cook_time_minutes"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="0"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Yield Quantity</label>
          <input
            type="number"
            step="0.01"
            formControlName="yield_quantity"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="0"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Yield Unit</label>
          <input
            type="text"
            formControlName="yield_unit"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="e.g., servings, portions"
          />
        </div>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900 flex items-center">
          <i class="fa-solid fa-list text-green-600 mr-2"></i>
          Ingredients
        </h2>
        <button
          type="button"
          (click)="addIngredient()"
          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center gap-2"
        >
          <i class="fa-solid fa-plus"></i>
          Add Ingredient
        </button>
      </div>

      <div *ngIf="ingredients.length === 0" class="text-center py-8 text-gray-500">
        <i class="fa-solid fa-utensils text-4xl mb-2"></i>
        <p>No ingredients added yet. Click "Add Ingredient" to get started.</p>
      </div>

      <div *ngIf="ingredients.length > 0" class="space-y-3">
        <div *ngFor="let ingredient of ingredients.controls; let i = index" [formGroupName]="i"
             class="grid grid-cols-12 gap-3 items-start p-3 bg-gray-50 rounded-lg">
          <div class="col-span-12 md:col-span-5">
            <input
              type="text"
              formControlName="name"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
              placeholder="Ingredient name"
            />
          </div>

          <div class="col-span-6 md:col-span-3">
            <input
              type="number"
              step="0.01"
              formControlName="quantity"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
              placeholder="Quantity"
            />
          </div>

          <div class="col-span-6 md:col-span-3">
            <select
              formControlName="unit"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            >
              <option value="">Unit</option>
              <option *ngFor="let unit of units" [value]="unit.name">
                {{ unit.display_name }}
              </option>
            </select>
          </div>

          <div class="col-span-12 md:col-span-1 flex items-center justify-center">
            <button
              type="button"
              (click)="removeIngredient(i)"
              class="text-red-600 hover:text-red-700 p-2"
              title="Remove ingredient"
            >
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Allergens -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
        <i class="fa-solid fa-triangle-exclamation text-orange-600 mr-2"></i>
        Allergens (UK 14)
      </h2>
      <p class="text-sm text-gray-600 mb-4">Select any allergens present in this recipe:</p>

      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
        <label *ngFor="let allergen of allergens"
               class="flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors"
               [ngClass]="isAllergenSelected(allergen) ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:bg-gray-50'"
               (click)="toggleAllergen(allergen)">
          <input
            type="checkbox"
            [checked]="isAllergenSelected(allergen)"
            class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            (click)="$event.stopPropagation()"
            (change)="toggleAllergen(allergen)"
          />
          <span class="text-sm" [ngClass]="isAllergenSelected(allergen) ? 'text-orange-700 font-medium' : 'text-gray-700'">
            {{ allergen }}
          </span>
        </label>
      </div>

      <div *ngIf="selectedAllergens.size > 0" class="mt-4 p-3 bg-orange-50 rounded-lg border border-orange-200">
        <p class="text-sm text-orange-800">
          <i class="fa-solid fa-info-circle mr-1"></i>
          <strong>Selected allergens ({{ selectedAllergens.size }}):</strong>
          {{ getSelectedAllergensArray().join(', ') }}
        </p>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
        <i class="fa-solid fa-file-lines text-green-600 mr-2"></i>
        Instructions
      </h2>

      <textarea
        formControlName="instructions"
        rows="8"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
        placeholder="Enter step-by-step cooking instructions..."
      ></textarea>
    </div>

    <!-- Notes -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
        <i class="fa-solid fa-note-sticky text-green-600 mr-2"></i>
        Additional Notes
      </h2>

      <textarea
        formControlName="notes"
        rows="4"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
        placeholder="Any additional notes, tips, or variations..."
      ></textarea>
    </div>

    <!-- Form Actions -->
    <div class="flex gap-4 justify-end">
      <button
        type="button"
        (click)="cancel()"
        class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="submitting || recipeForm.invalid"
        class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"
      >
        <i class="fa-solid" [ngClass]="submitting ? 'fa-spinner fa-spin' : 'fa-save'"></i>
        {{ submitting ? 'Saving...' : (isEditMode ? 'Update Recipe' : 'Create Recipe') }}
      </button>
    </div>
  </form>
</div>
