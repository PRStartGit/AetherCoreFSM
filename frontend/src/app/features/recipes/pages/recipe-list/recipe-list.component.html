<div class="p-4 md:p-6">
  <!-- Header -->
  <div class="mb-6 flex flex-wrap items-center justify-between gap-4">
    <div class="flex items-center gap-4">
      <a routerLink="/recipes" class="back-btn" title="Back to Recipe Home">
        <i class="fa-solid fa-arrow-left"></i>
      </a>
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Recipe Book</h1>
        <p class="text-gray-600 mt-1">Browse and search organization recipes</p>
      </div>
    </div>
    <button
      *ngIf="canCreate()"
      (click)="createRecipe()"
      class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
    >
      <i class="fa-solid fa-plus"></i>
      Create Recipe
    </button>
  </div>

  <!-- Search & Filters -->
  <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (keyup.enter)="applyFilters()"
            class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
            placeholder="Search recipes by title..."
          />
          <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Recipe Book</label>
        <select
          [(ngModel)]="selectedBookId"
          (change)="applyFilters()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
        >
          <option [value]="null">All Recipe Books</option>
          <option *ngFor="let book of recipeBooks" [value]="book.id">
            {{ book.title }}
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
        <select
          [(ngModel)]="selectedCategoryId"
          (change)="applyFilters()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
        >
          <option [value]="null">All Categories</option>
          <option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Exclude Allergen</label>
        <select
          [(ngModel)]="selectedAllergen"
          (change)="applyFilters()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
        >
          <option value="">No Filter</option>
          <option *ngFor="let allergen of allergens" [value]="allergen">
            {{ allergen }}
          </option>
        </select>
      </div>
    </div>

    <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200">
      <label class="flex items-center gap-2 text-sm text-gray-700 cursor-pointer">
        <input
          type="checkbox"
          [(ngModel)]="showArchived"
          (change)="applyFilters()"
          class="rounded border-gray-300 text-green-600 focus:ring-green-500"
        />
        <span>Show archived recipes</span>
      </label>

      <button
        (click)="clearFilters()"
        class="text-sm text-gray-600 hover:text-gray-800 flex items-center gap-1"
      >
        <i class="fa-solid fa-filter-circle-xmark"></i>
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <svg class="animate-spin h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="bg-red-50 border-l-4 border-red-500 rounded-r-lg p-6">
    <div class="flex items-start">
      <i class="fa-solid fa-exclamation-circle text-red-600 text-xl mt-1 mr-3"></i>
      <div>
        <h3 class="font-semibold text-red-900 mb-1">Error</h3>
        <p class="text-red-800 text-sm">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && recipes.length === 0" class="text-center py-16">
    <div class="mb-6">
      <i class="fa-solid fa-utensils text-6xl text-gray-300"></i>
    </div>
    <h3 class="text-2xl font-bold text-gray-700 mb-2">No Recipes Yet</h3>
    <p class="text-gray-600 mb-6">
      Your organization hasn't added any recipes to the Recipe Book yet.
    </p>
    <a routerLink="/recipes" class="inline-flex items-center gap-2 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">
      <i class="fa-solid fa-arrow-left"></i>
      Back to Recipe Home
    </a>
  </div>

  <!-- Recipe List (Phase 2 - Full Implementation) -->
  <div *ngIf="!loading && !error && recipes.length > 0">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div *ngFor="let recipe of recipes"
           (click)="viewRecipe(recipe.id)"
           class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer border border-gray-200 overflow-hidden">
        <!-- Thumbnail -->
        <div class="h-40 bg-gray-100 relative overflow-hidden">
          <img *ngIf="recipe.photo_url"
               [src]="'/uploads/' + recipe.photo_url"
               [alt]="recipe.title"
               class="w-full h-full object-cover"
               (error)="onImageError($event)">
          <div *ngIf="!recipe.photo_url" class="w-full h-full flex items-center justify-center">
            <i class="fa-solid fa-utensils text-4xl text-gray-300"></i>
          </div>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-bold text-gray-900 mb-1 line-clamp-1">{{ recipe.title }}</h3>
          <p *ngIf="recipe.description" class="text-gray-600 text-sm mb-3 line-clamp-2">
            {{ recipe.description }}
          </p>
          <div class="flex items-center justify-between text-sm text-gray-500">
            <span *ngIf="recipe.category_name" class="flex items-center gap-1">
              <i class="fa-solid fa-tag"></i>
              {{ recipe.category_name }}
            </span>
            <span *ngIf="recipe.total_time_minutes" class="flex items-center gap-1">
              <i class="fa-solid fa-clock"></i>
              {{ recipe.total_time_minutes }} min
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 1 Note: Full functionality coming in Phase 2 -->
  <!-- Phase 2 will include: -->
  <!-- - Search and filter controls -->
  <!-- - Category filtering -->
  <!-- - Allergen filtering -->
  <!-- - Recipe details modal/page -->
  <!-- - Print/PDF functionality (Phase 3) -->
</div>
